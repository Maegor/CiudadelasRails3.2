
<div id="build_severals" class="hidden">
  <div class="popupContainer">
    <a  class="closePopup" title="close popup"></a>
 <% district_list = current_user.player.district_to_construct  %>
<%= form_tag form_action 'build_severals' do %>

    <% district_list.each do |card|%>
         <span class="image-checkbox-container">
        <%= check_box_tag 'cards[]', card.id %>
         <%= (render :partial => 'district_card', :object => card)  %>
        <%#= label_tag 'cards[]', (t 'districts.' + card.base_card.name) %>
        </span>
    <% end %>
    <%= submit_tag  'Construir' %>

<% end %>
<script type="text/javascript">
    var coins = <%= current_user.player.coins %>
    var cost_hash = new Object();
    <% district_list.each do |card|%>
         cost_hash[<%= card.id %>] = <%= card.base_card.cost %>

      <% end%>

    $('.image-checkbox-container div').on('click', function(){
        check = $(this).prev('input[type="checkbox"]')

        if(!check.attr("disabled")) {
        if(!check.prop('checked') ){
            check.prop('checked', true).attr('checked','checked');
            this.style.border = '4px solid #38A';
            this.style.margin = '0px';
            coins = coins - cost_hash[check.val()]

        }else{
            check.prop('checked', false).removeAttr('checked');
            this.style.border = '0';
            this.style.margin = '4px';
            coins = coins + cost_hash[check.val()]
        }


        var bol = $("input[type=checkbox][name='cards[]']:checked").length >= 3;


        if (bol){
            unchecked_checks = $("input[type=checkbox][name='cards[]']").not(":checked")
            unchecked_checks.attr("disabled",bol);


        }else{

            $("input[type=checkbox][name='cards[]']").not(":checked").each(function( index, check) {

                var bol =  (coins - cost_hash[$(this).val()] < 0)
                $(this).attr("disabled",bol);

            })
        }
    }
    });


</script>
   </div>
</div>
